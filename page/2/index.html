<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>SubHy的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="记录日常的学习">
<meta property="og:type" content="website">
<meta property="og:title" content="SubHy的博客">
<meta property="og:url" content="http://SubHyCan.github.io/page/2/index.html">
<meta property="og:site_name" content="SubHy的博客">
<meta property="og:description" content="记录日常的学习">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="SubHy的博客">
<meta name="twitter:description" content="记录日常的学习">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    
    <div id="header-inner" class="inner">
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://SubHyCan.github.io"></form>
      </div>
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
      </nav>
      
    </div>
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">SubHy的博客</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">成长之路</a>
        </h2>
      
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Docker-Study" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/02/14/Docker-Study/" class="article-date">
  <time datetime="2019-02-14T08:25:49.268Z" itemprop="datePublished">2019-02-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/02/14/Docker-Study/">Docker Study</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h2 id="Centos下Docker学习"><a href="#Centos下Docker学习" class="headerlink" title="Centos下Docker学习"></a>Centos下Docker学习</h2><h3 id="Centos-7安装和卸载Docker-CE开源社区版"><a href="#Centos-7安装和卸载Docker-CE开源社区版" class="headerlink" title="Centos 7安装和卸载Docker CE开源社区版"></a>Centos 7安装和卸载Docker CE开源社区版</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2 curl       <span class="comment">#安装设置镜像仓库所需包</span></span><br><span class="line">sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo      <span class="comment">#设置stable镜像仓库                      </span></span><br><span class="line">sudo yum list docker-ce.x86_64  --showduplicates | sort -r   <span class="comment">#列出软件可用的版本，可根据版本安装</span></span><br><span class="line">sudo yum -y install docker-ce                                <span class="comment">#安装最新版</span></span><br><span class="line">sudo docker --version                                        <span class="comment">#查看docker版本</span></span><br><span class="line">sudo docker run hello-world                                  <span class="comment">#验证是否安装成功</span></span><br><span class="line">sudo yum remove docker-ce                                    <span class="comment">#卸载docker-ce </span></span><br><span class="line">sudo rm -rf /var/lib/docker                                  <span class="comment">#删除所有镜像、容器和存储卷</span></span><br></pre></td></tr></table></figure>
<h3 id="配置加速器"><a href="#配置加速器" class="headerlink" title="配置加速器"></a>配置加速器</h3><h4 id="第一种"><a href="#第一种" class="headerlink" title="第一种:"></a>第一种:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo cat &gt; /etc/docker/daemon.json &lt;&lt; EOF</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"registry-mirrors"</span> : [</span><br><span class="line">	    <span class="string">"https://i3jtbyvy.mirror.aliyuncs.com"</span>            <span class="comment">#加速器地址还可为:https://registry.docker-cn.com</span></span><br><span class="line">	],</span><br><span class="line">	<span class="string">"debug"</span> : <span class="literal">true</span>,</span><br><span class="line">	<span class="string">"experimental"</span> : <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>
<h4 id="第二种"><a href="#第二种" class="headerlink" title="第二种:"></a>第二种:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">enable</span> docker            <span class="comment">#启用docker服务</span></span><br><span class="line">sudo vi /etc/systemd/system/multi-user.target.wants/docker.service   <span class="comment">#编辑，找到ExecStart=这一行，改为下一行所示的内容</span></span><br><span class="line">ExecStart=/usr/bin/dockerd --registry-mirror=https://i3jtbyvy.mirror.aliyuncs.com</span><br></pre></td></tr></table></figure>
<h3 id="Docker安装websphere"><a href="#Docker安装websphere" class="headerlink" title="Docker安装websphere"></a>Docker安装websphere</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sudo docker login                                 <span class="comment">#登录Docker Cloud，需输入用户名和密码 </span></span><br><span class="line">sudo docker search websphere                      <span class="comment">#查看与websphere相关的镜像</span></span><br><span class="line">sudo docker pull ibmcom/websphere-traditional     <span class="comment">#下载镜像到本地</span></span><br><span class="line">sudo docker images                                <span class="comment">#查看本地镜像，不同的仓库它的镜像ID可以相同</span></span><br><span class="line">sudo docker run --name websphere \                <span class="comment">#通过镜像来运行一个名为websphere的容器,可指定端口映射，容器名等</span></span><br><span class="line">-h websphere \ </span><br><span class="line">-e UPDATE_HOSTNAME=<span class="literal">true</span> \ </span><br><span class="line">-p 9043:9043 \</span><br><span class="line">-p 9443:9443 \</span><br><span class="line">-d ibmcom/websphere-traditional </span><br><span class="line">sudo docker <span class="built_in">exec</span> websphere cat /tmp/PASSWORD      <span class="comment">#进入容器内部输出websphere的登录密码，用户名为wsadmin</span></span><br><span class="line">sudo docker ps                                    <span class="comment">#查看容器有没有在运行,访问http://localhost:9043/ibm/cosole来登录控制台</span></span><br></pre></td></tr></table></figure>
<h3 id="Docker常用命令"><a href="#Docker常用命令" class="headerlink" title="Docker常用命令"></a>Docker常用命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">sudo docker ps -a                             <span class="comment">#查看所有容器</span></span><br><span class="line">sudo docker ps                                <span class="comment">#查看在运行的容器</span></span><br><span class="line">sudo docker stop 容器名/容器ID                <span class="comment">#停止一个运行中的容器，发出一个停止信号，等待容器停止</span></span><br><span class="line">sudo docker <span class="built_in">kill</span> 容器名/容器ID                <span class="comment">#直接杀死容器</span></span><br><span class="line">sudo docker start 容器名/容器ID               <span class="comment">#运行一个容器</span></span><br><span class="line">sudo docker rm 容器名/容器ID                  <span class="comment">#删除一个容器</span></span><br><span class="line">sudo docker rmi 仓库名:标签/镜像ID            <span class="comment">#删除一个镜像，基于此镜像运行的容器必须删除，同名需指定版本，即镜像名:版本</span></span><br><span class="line">sudo docker rmi $(docker images -q)           <span class="comment">#删除所有镜像  </span></span><br><span class="line">sudo docker tag hello-world subcan/get-started:<span class="built_in">test</span>                  <span class="comment">#发布过程为先标记一个镜像，标记的仓库为自己docker hub上想存放镜像的仓库</span></span><br><span class="line">sudo docker push subcan/get-started:<span class="built_in">test</span>                             <span class="comment">#发布镜像到Docker Cloud仓库</span></span><br><span class="line">sudo docker login                                                    <span class="comment">#登录Docker Cloud仓库</span></span><br><span class="line">sudo docker pull subcan/get-started:FirstBuildImages                 <span class="comment">#登录Docker Cloud后，可pull一个自己镜像仓库的的镜像到本地</span></span><br><span class="line">sudo docker <span class="built_in">logout</span>                                                   <span class="comment">#退出登录  </span></span><br><span class="line">sudo docker inspect 容器名/容器ID                                     <span class="comment">#对容器进行详细的检查，返回配置信息   </span></span><br><span class="line">sudo docker inspect 镜像ID/仓库ID:标签                               <span class="comment">#查看镜像的详细信息</span></span><br><span class="line">sudo docker run learn/tutorial apt-get install -y ping               <span class="comment">#运行一个容器并在容器中安装ping     </span></span><br><span class="line">sudo docker commit 容器名/容器ID 镜像名                              <span class="comment">#把一个容器做成镜像</span></span><br><span class="line">sudo docker <span class="built_in">log</span> [-f][-t] 镜像                                        <span class="comment">#查看容器的日志</span></span><br><span class="line">sudo docker top 容器名/容器ID                                        <span class="comment">#查看容器的进程 </span></span><br><span class="line">sudo docker <span class="built_in">exec</span> 容器名 命令                                         <span class="comment">#对运行中的容器启动一个新的进程</span></span><br><span class="line">sudo man docker-run                                                  <span class="comment">#使用Docker帮助文件。其他命令也可查看</span></span><br><span class="line">sudo docker port 容器名/容器ID                                       <span class="comment">#查看容器端口映射的情况</span></span><br><span class="line">sudo docker info                                                     <span class="comment">#查看docker信息   </span></span><br><span class="line">sudo docker version                                                  <span class="comment">#查看docker版</span></span><br><span class="line">sudo docker images --no-trunc                                        <span class="comment">#可查看镜像完整的ID</span></span><br><span class="line">sudo docker images -a                                                <span class="comment">#查看所有的镜像，其中为&lt;none&gt;的镜像表示中间层镜像</span></span><br><span class="line">sudo docker images -q                                                <span class="comment">#只查看镜像ID</span></span><br><span class="line">sudo docker images 仓库名字                                          <span class="comment">#查看指定的镜像</span></span><br></pre></td></tr></table></figure>
<h3 id="docker-run命令"><a href="#docker-run命令" class="headerlink" title="docker run命令"></a>docker run命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run [参数] </span><br><span class="line">参数:-d 以守护式进程的方式运行容器</span><br></pre></td></tr></table></figure>
<h3 id="守护式容器"><a href="#守护式容器" class="headerlink" title="守护式容器"></a>守护式容器</h3><p>例:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -i -t --name test1 ubuntu /bin/bash                       <span class="comment">#进入交互式容器环境</span></span><br><span class="line">Ctrl+P Ctrl+Q                                                        <span class="comment">#退出交互式环境，不影响容器运行，如果输入exit退出，则容器停止运行</span></span><br><span class="line">docker attach 容器名/容器ID                                          <span class="comment">#进入运行的容器中</span></span><br></pre></td></tr></table></figure></p>
<p>docker 概念 仓库，仓库:标签<br>Dockerfile构建镜像<br>进入Dockerfile文件目录，执行命令，执行成功，即构建了一个镜像<br>docker build -t=”仓库名” .<br>docker build -t=”仓库名” –no-cache.                        #不使用镜像缓存  </p>
<p>docker c/s模式的连接方式<br>unix:///var/run/docker.sock            #默认使用它，可以nc来连接，如:nc -u /var/run/docker.sock<br>tcp://host:port<br>fd://socketfd</p>
<p>docker 远程访问<br>不同的机器，修改docker守护进程启动项(labels标签)，区别服务器，保证client api 与server api版本一致，-H选项配置启动选项,客户端可通过export Docker_HOST=”服务端访问方式”，来访问服务端docker info，为空表示访问本地的docker</p>
<p>可自定义修改linux虚拟网桥docker0的ip地址和掩码，docker运行的容器通过网桥docker0来通信，每运行一个容器，docker0会自动分配一个ip和mac地址给容器<br>ifconfig docker0 192.168.200.1 netmask 255.255.255.0</p>
<p>yum install bridge-utils -y<br>brctl show                          #查看网桥</p>
<p>brctl addbr br0                     #添加一个虚拟网桥<br>ifconfig br0 192.168.100.1 netmask 255.255.255.0<br>守护进程启动配置中添加DOCKER_OPS值 -b=br0，则可以将自定义的虚拟网桥添加给docker使用</p>
<p>容器与外部网络连接<br>sysctl net.ipv4.conf.all.forwarding 查看net.ipv4.conf.all.forwarding，默认开启，值等于1</p>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://SubHyCan.github.io/2019/02/14/Docker-Study/" data-id="cjsvb16u20001syrighjpvupv" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>
 


  
    <article id="post-Docker-Quick-Start-Guide" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/02/14/Docker-Quick-Start-Guide/" class="article-date">
  <time datetime="2019-02-14T08:25:49.268Z" itemprop="datePublished">2019-02-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/02/14/Docker-Quick-Start-Guide/">Docker-Quick-Start-Guide</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h2 id="注-本文为转载"><a href="#注-本文为转载" class="headerlink" title="注:本文为转载"></a><code>注:本文为转载</code></h2><h2 id="原文出处-enter"><a href="#原文出处-enter" class="headerlink" title="原文出处: enter"></a><code>原文出处:</code> <a href="https://github.com/buxiaomo/MarkdownBooks/blob/master/Docker入门级简易手册.md" target="_blank" rel="noopener">enter</a></h2><p>Docker入门级简易手册</p>
<p>本篇仅作为新手入门使用，大神们可以指导小弟修正，不喜勿喷，谢谢</p>
<p>在线版：<a href="https://github.com/buxiaomo/MarkdownBooks" target="_blank" rel="noopener">https://github.com/buxiaomo/MarkdownBooks</a></p>
<p>本篇主要讲解如下几个知识点：</p>
<ol>
<li><p>CentOS7与Ubuntu下安装Docker，配置加速器</p>
</li>
<li><p>常见Dockerfile命令讲解</p>
</li>
<li><p>docker-compo安装与常见命令讲解</p>
</li>
<li><p>集群环境下如何使用compose编排</p>
</li>
<li><p>根据项目如何使用Docker部署应用</p>
<ol>
<li>Swarm集群下发布基于LNMP的WordPress应用发布</li>
<li>NodeJS应用发布</li>
<li>Flask应用发布</li>
<li>基于Tomcat定制封装Jenkins镜像</li>
</ol>
</li>
<li><p>每次代码写好了都要自己构建觉得麻烦怎么办？</p>
</li>
</ol>
<h2 id="CentOS7与Ubuntu下安装Docker"><a href="#CentOS7与Ubuntu下安装Docker" class="headerlink" title="CentOS7与Ubuntu下安装Docker"></a>CentOS7与Ubuntu下安装Docker</h2><h3 id="CentOS7"><a href="#CentOS7" class="headerlink" title="CentOS7"></a>CentOS7</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2 curl</span><br><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">yum -y install docker-ce</span><br></pre></td></tr></table></figure>
<h3 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">apt-get remove docker docker-engine docker.io -y</span><br><span class="line"></span><br><span class="line">apt-get update</span><br><span class="line"></span><br><span class="line">apt-get install apt-transport-https ca-certificates curl gnupg2 software-properties-common -y</span><br><span class="line"></span><br><span class="line">curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -</span><br><span class="line"></span><br><span class="line">apt-key fingerprint 0EBFCD88</span><br><span class="line"></span><br><span class="line">add-apt-repository "deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable"</span><br><span class="line"></span><br><span class="line">apt-get update</span><br><span class="line"></span><br><span class="line">apt-get install docker-ce -y</span><br></pre></td></tr></table></figure>
<h3 id="配置加速器"><a href="#配置加速器" class="headerlink" title="配置加速器"></a>配置加速器</h3><p>​    不想申请加速器的朋友可以使用我的，也可以自己去申请阿里云或者Daocloud的加速器。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /etc/docker</span><br><span class="line"></span><br><span class="line">cat &gt; /etc/docker/daemon.json &lt;&lt; EOF</span><br><span class="line">&#123;</span><br><span class="line">    &quot;registry-mirrors&quot; : [</span><br><span class="line">	    &quot;https://i3jtbyvy.mirror.aliyuncs.com&quot;</span><br><span class="line">	],</span><br><span class="line">	&quot;debug&quot; : true,</span><br><span class="line">	&quot;experimental&quot; : true</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>
<h2 id="常见Dockerfile命令讲解"><a href="#常见Dockerfile命令讲解" class="headerlink" title="常见Dockerfile命令讲解"></a>常见Dockerfile命令讲解</h2><p>​    Dockerfile简单一点就是描述你这个镜像安装了哪些软件包，有哪些操作，创建了什么东西。有些人喜欢用 <code>docker commit</code> 命令去打包镜像，这样是不好的，首先commit出来的镜像比你使用Dockerfile构建出来的体积大，而且commit出来的镜像属于黑盒镜像，除了制作者，谁都不知道你在里面干了什么，属于不安全的镜像，很少会有人使用，最后就是不便于你最终的管理和更新。所以推荐使用Dockerfile去管理你的镜像，下面将简单介绍Dockerfile常见的指令和注意事项：</p>
<h3 id="FROM"><a href="#FROM" class="headerlink" title="FROM"></a><code>FROM</code></h3><p>​    FROM命令是指定你所使用的基础镜像，一般写在文件开头，对于官方没给出Dockerfile的软件想Docker化，那么引用的镜像一般是<code>debian:jessie</code>、<code>alpine</code>、<code>ubuntu</code>，如果官方已经有了，比如nginx、php、mysql这写，那么基本直接引用即可。</p>
<p>指令语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">FROM &lt;image&gt;</span><br><span class="line">FROM &lt;image&gt;:&lt;tag&gt;</span><br><span class="line">FROM &lt;image&gt;:&lt;digest&gt; </span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line">FROM debian:jessie</span><br><span class="line">FROM alpine:3.6</span><br><span class="line">FROM ubuntu:16.04</span><br><span class="line">FROM mysql:5.7</span><br><span class="line">FROM python:2.7</span><br></pre></td></tr></table></figure>
<h3 id="MAINTAINER"><a href="#MAINTAINER" class="headerlink" title="MAINTAINER"></a><code>MAINTAINER</code></h3><p>​    MAINTAINER命令一般是描述这个Dockerfile的作者信息，</p>
<p>指令语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MAINTAINER &lt;name&gt;</span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line">MAINTAINER &quot;MoMo&quot; &lt;95112082@qq.com&gt;</span><br></pre></td></tr></table></figure>
<h3 id="RUN"><a href="#RUN" class="headerlink" title="RUN"></a><code>RUN</code></h3><p>​    运行指定的命令，此命令只有在执行<code>docker build</code>时才会执行，其他情况下不会执行。这时候有很多初学者会以为在写SHELL，那么在一个Dockerfile里面会出现很多不合理的RUN指令，了解过Docker的朋友应该都知道Docker的镜像是分层结构，说白了就是Dockerfile里面一个指令的操作就是一层。比如下面的操作，一条RUN命令包含了更新源缓存，安装openjdk，清理垃圾，这样的好处是最终这一层会很小，假设你分开写，四个命令四个RUN指令，但是只有第二条命令才是你想要的，那么第一条产生的缓存垃圾就不发删除掉。这也算是优化的一部分。</p>
<p>指令语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">这里只写第一种格式，有兴趣的朋友可以去官网看看其他的方式</span><br><span class="line">RUN &lt;command&gt;</span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line">RUN apt-get update \</span><br><span class="line">    &amp;&amp; apt-get install openjdk-8-jdk --no-install-recommends -y \</span><br><span class="line">    &amp;&amp; apt-get clean all \</span><br><span class="line">    &amp;&amp; rm -rf /var/lib/apt/lists/*</span><br></pre></td></tr></table></figure>
<h3 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a><code>CMD</code></h3><p>​    设置容器启动时要运行的命令只有在你执行 <code>docker run</code> 或者 <code>docker start</code> 命令是才会运行，其他情况下不运行。如果一个Dockerfile里面有多条CMD指令，那么只有文件最后一行的 <code>CMD</code> 指令才会生效，其他的全部没用，还有一点，还有一点 <code>CMD</code> 指令是可以在你执行 <code>docker run</code> 的时候覆盖的。</p>
<p>指令语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CMD [&quot;executable&quot;,&quot;param1&quot;,&quot;param2&quot;]</span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line">CMD [&quot;python&quot;,&quot;flask.py&quot;]</span><br></pre></td></tr></table></figure>
<h3 id="EXPOSE"><a href="#EXPOSE" class="headerlink" title="EXPOSE"></a><code>EXPOSE</code></h3><p>​    设置暴露的容器端口，注意是容器端口。</p>
<p>指令语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">EXPOSE port</span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line">EXPOSE 80</span><br><span class="line">EXPOSE 80 443</span><br></pre></td></tr></table></figure>
<h3 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a><code>ENV</code></h3><p>​    功能为设置环境变量，此环节变量可以是在构建镜像时使用，也可以在运行中的容器使用。</p>
<p>指令语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ENV &lt;key&gt; &lt;value&gt;</span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line">一种写法</span><br><span class="line">ENV JAVA_HOME /usr/lib/jvm/java-7-openjdk-amd64</span><br><span class="line">ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line">ENV PATH $PATH:$JAVA_HOME/bin:$JRE_HOME/bin</span><br><span class="line"></span><br><span class="line">另一种写法</span><br><span class="line">ENV JAVA_HOME=/usr/lib/jvm/java-7-openjdk-amd64 \</span><br><span class="line">    CLASSPATH=$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar \</span><br><span class="line">    PATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/bin</span><br></pre></td></tr></table></figure>
<h3 id="ADD"><a href="#ADD" class="headerlink" title="ADD"></a><code>ADD</code></h3><p>​    复制命令，把本机的文件复制到镜像中，如果dest是目录则会帮你创建出这个目录，如果src是压缩文件会帮你解压出来。当然ADD指令中的src也可以是URL链接，还有另外一个指令（<code>COPY</code>），请注意区别！！！</p>
<p>​    另外，src部分是是你Dockerfile的相对路径，这个请注意！！！</p>
<p>指令语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ADD &lt;src&gt; &lt;dest&gt;</span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line">ADD nginx.conf /etc/nginx/nginx.conf</span><br><span class="line">ADD app.tar.gz /app/app.tar.gz</span><br></pre></td></tr></table></figure>
<h3 id="COPY"><a href="#COPY" class="headerlink" title="COPY"></a><code>COPY</code></h3><p>​    与ADD指令一样，但是COPY的src部分只能是本地文件，文件路径是Dockerfile的相对路径。如果dest是目录并且目录不存在，会帮你创建，如果是压缩文件不会帮你解压。</p>
<p>指令语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">COPY &lt;src&gt; &lt;dest&gt;</span><br><span class="line"></span><br><span class="line">COPY app.tar.gz /app/</span><br></pre></td></tr></table></figure>
<h3 id="ENTRYPOINT"><a href="#ENTRYPOINT" class="headerlink" title="ENTRYPOINT"></a><code>ENTRYPOINT</code></h3><p>​    启动时的默认命令，此指令设置的命令不可修改。与CMD是有区别的。此命令在Dockerfile只能有一个，若有多个，则以文件最后一个出现的才生效。</p>
<p>指令语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ENTRYPOINT [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;]</span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line">ENTRYPOINT [&quot;nginx&quot;]</span><br><span class="line">CMD [&quot;-g&quot;,&quot;daemon off;&quot;]</span><br></pre></td></tr></table></figure>
<p>​    如上，如果执行 <code>docker run -d --name nginx -P nginx</code> 则最终容器内执行的命令是<code>nginx -g daemon off;</code> ，如果你执行的命令是 <code>docker run -d --name nginx -P nginx bash</code> 则最终容器内执行的命令是<code>nginx bash</code> 注意区别，细心体会。</p>
<h3 id="VOLUME"><a href="#VOLUME" class="headerlink" title="VOLUME"></a><code>VOLUME</code></h3><p>​    设置你的卷，在启动容器的时候Docker会在/var/lib/docker的下一级目录下创建一个卷，以保存你在容器中产生的数据。若没有申明则不会创建。</p>
<p>指令语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">VOLUME [&quot;/path/to/directory&quot;]</span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line">VOLUME [&quot;/data&quot;]</span><br><span class="line">VOLUME [&quot;/data&quot;,&quot;/app/etc&quot;]</span><br></pre></td></tr></table></figure>
<h3 id="USER"><a href="#USER" class="headerlink" title="USER"></a><code>USER</code></h3><p>​    指定容器运行的用户是谁，前提条件，用户必须<strong>存在</strong>。此指令可以在构建镜像是使用或指定容器中进程的运行用户是谁。</p>
<p>指令语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">USER daemo</span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line">USER nginx</span><br></pre></td></tr></table></figure>
<h3 id="WORKDIR"><a href="#WORKDIR" class="headerlink" title="WORKDIR"></a><code>WORKDIR</code></h3><p>​    指定容器中的工作目录，可以在构建时使用，也可以在启动容器时使用，构建使用就是通过 <code>WORKDIR</code> 将当前目录切换到指定的目录中，容器中使用的意思则是在你使用 <code>docker run</code> 命令启动容器时，默认进入的目录是 <code>WORKDIR</code> 指定的，下面的example中我使用环境变量。</p>
<p>指令语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">WORKDIR /path/to/workdir</span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line">WORKDIR /usr/local/zookeeper-$&#123;ZOOKEEPER_VERSION&#125;</span><br></pre></td></tr></table></figure>
<p>以上为常用的Dockerfile指令，详细文档请参考官方文档：<a href="https://docs.docker.com/engine/reference/builder/" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/builder/</a></p>
<h2 id="docker-compose安装与常见命令讲解"><a href="#docker-compose安装与常见命令讲解" class="headerlink" title="docker-compose安装与常见命令讲解"></a>docker-compose安装与常见命令讲解</h2><h3 id="docker-compose安装"><a href="#docker-compose安装" class="headerlink" title="docker-compose安装"></a>docker-compose安装</h3><h4 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl -L https://github.com/docker/compose/releases/download/1.18.0/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose</span><br><span class="line">chmod +x /usr/local/bin/docker-compose</span><br><span class="line"><span class="meta">#</span><span class="bash">查看版本</span></span><br><span class="line">docker-compose version</span><br></pre></td></tr></table></figure>
<h4 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CentOS:</span><br><span class="line">yum install epel-release -y</span><br><span class="line">yum install python-pip -y</span><br><span class="line"></span><br><span class="line">Ubuntu:</span><br><span class="line">apt-get install python-pip -y</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 通用命令</span></span><br><span class="line">pip --version</span><br><span class="line">pip install --upgrade pip</span><br><span class="line">pip install -U -i https://pypi.tuna.tsinghua.edu.cn/simple docker-compose </span><br><span class="line">docker-compose version</span><br></pre></td></tr></table></figure>
<h3 id="常见命令讲解"><a href="#常见命令讲解" class="headerlink" title="常见命令讲解"></a>常见命令讲解</h3><h4 id="单机docker-compose模版"><a href="#单机docker-compose模版" class="headerlink" title="单机docker-compose模版"></a>单机docker-compose模版</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义docker-compose版本，有些参数只有高版本才有，底版本没有</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">'3.4'</span></span><br><span class="line"><span class="comment"># 定义服务，可以是一个，也可以是多个</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">	<span class="comment"># 具体的服务名，其他的服务可以用过这个名字访问</span></span><br><span class="line"><span class="attr">    nginx:</span></span><br><span class="line">    	<span class="comment"># 定义这个服务所使用的镜像以及进项版本，若不指定版本默认是latest，生产环境不建议使用latest</span></span><br><span class="line"><span class="attr">        image:</span> <span class="attr">nginx:1.13.6-alpine</span></span><br><span class="line">        <span class="comment"># 定义容器启动后的主机名，其他的服务可以用过这个名字访问</span></span><br><span class="line"><span class="attr">        hostname:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="comment"># 定义暴露端口，若写成 '80:80/tcp' 的格式则表示指定宿主机的80转发到容器的80，若写成 '80/tcp' 则表示Docker将随机分配一个宿主机端口给容器内的80端口，tcp表示协议类型，也可以是udp</span></span><br><span class="line"><span class="attr">        ports:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="number">80</span><span class="string">:80/tcp</span></span><br><span class="line">        <span class="comment"># 网络定义部分</span></span><br><span class="line"><span class="attr">        networks:</span></span><br><span class="line">        	<span class="comment"># 定义这个容器运行在哪个虚拟网络里面</span></span><br><span class="line"><span class="attr">            wordpress:</span></span><br><span class="line">            	<span class="comment"># 设置这个容器在网络中的别名，可以是一个，可以是多个，其他的服务可以用过这个名字访问</span></span><br><span class="line"><span class="attr">                aliases:</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="string">nginx</span></span><br><span class="line">        <span class="comment"># 定义卷，可以是卷，也可以是目录，可以设置容器内的权限是什么</span></span><br><span class="line"><span class="attr">        volumes:</span></span><br><span class="line">        	<span class="comment"># 将docker-compose的相对目录下的nginx配置文件挂载到容器内的/etc/nginx/nginx.conf地方去，权限是只读</span></span><br><span class="line">        	<span class="comment"># 大致格式：src:dest:mode</span></span><br><span class="line">        	<span class="comment"># src: 可以是卷名，宿主机目录等，可以是文件或者目录，若是文件则文件必须存在，否则会是目录的形式挂载</span></span><br><span class="line">        	<span class="comment"># dest: 容器内的路径，可以是文件可以是目录，若是文件则文件必须存在，否则会是目录的形式挂载</span></span><br><span class="line">        	<span class="comment"># mode: 权限，只读(ro)，可读可写(rw)</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">./nginx/nginx.conf:/etc/nginx/nginx.conf:ro</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">./www:/var/www/html:rw</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">/usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro</span></span><br><span class="line">        <span class="comment"># 日志定义</span></span><br><span class="line"><span class="attr">        logging:</span></span><br><span class="line">        	<span class="comment"># 使用的驱动是什么，官方给出很多方式，具体可以查看官方文档，这里使用的json-file</span></span><br><span class="line"><span class="attr">            driver:</span> <span class="string">json-file</span></span><br><span class="line">            <span class="comment"># 定义日志的参数</span></span><br><span class="line"><span class="attr">            options:</span></span><br><span class="line">            	<span class="comment"># 设置最大文件数3个，每个文件大小为100MB</span></span><br><span class="line"><span class="attr">                max-file:</span> <span class="string">'3'</span></span><br><span class="line"><span class="attr">                max-size:</span> <span class="number">100</span><span class="string">m</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 下面的部分我只会将上面没有出现的部分注释出来，有的部分不做说明             </span></span><br><span class="line"><span class="attr">    wordpress:</span></span><br><span class="line"><span class="attr">        image:</span> <span class="attr">wordpress:4.9.1-php7.1-fpm-alpine</span></span><br><span class="line"><span class="attr">        hostname:</span> <span class="string">php</span></span><br><span class="line"><span class="attr">        networks:</span></span><br><span class="line"><span class="attr">            wordpress:</span></span><br><span class="line"><span class="attr">                aliases:</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="string">wordpress</span></span><br><span class="line">        <span class="comment"># 环境变量设置，key=value</span></span><br><span class="line"><span class="attr">        environment:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">WORDPRESS_DB_HOST=mysql</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">WORDPRESS_DB_USER=root</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">WORDPRESS_DB_PASSWORD=root</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">WORDPRESS_DB_NAME=xbclub</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">WORDPRESS_TABLE_PREFIX=wp_</span></span><br><span class="line"><span class="attr">        volumes:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">./www:/var/www/html:rw</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">./php/uploads.ini:/usr/local/etc/php/conf.d/uploads.ini:ro</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">/usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro</span></span><br><span class="line"><span class="attr">        logging:</span></span><br><span class="line"><span class="attr">            driver:</span> <span class="string">json-file</span></span><br><span class="line"><span class="attr">            options:</span></span><br><span class="line"><span class="attr">                max-file:</span> <span class="string">'3'</span></span><br><span class="line"><span class="attr">                max-size:</span> <span class="number">100</span><span class="string">m</span></span><br><span class="line"><span class="attr">    mysql:</span></span><br><span class="line"><span class="attr">        image:</span> <span class="attr">mysql:5.7.20</span></span><br><span class="line"><span class="attr">        hostname:</span> <span class="string">mysql</span></span><br><span class="line"><span class="attr">        networks:</span></span><br><span class="line"><span class="attr">            wordpress:</span></span><br><span class="line"><span class="attr">                aliases:</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="string">mysql</span></span><br><span class="line"><span class="attr">        environment:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">MYSQL_ROOT_PASSWORD=root</span></span><br><span class="line"><span class="attr">        volumes:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">./mysql:/var/lib/mysql</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">/usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro</span></span><br><span class="line"><span class="attr">        logging:</span></span><br><span class="line"><span class="attr">            driver:</span> <span class="string">json-file</span></span><br><span class="line"><span class="attr">            options:</span></span><br><span class="line"><span class="attr">                max-file:</span> <span class="string">'3'</span></span><br><span class="line"><span class="attr">                max-size:</span> <span class="number">100</span><span class="string">m</span></span><br><span class="line"><span class="attr">    redis:</span></span><br><span class="line"><span class="attr">        image:</span> <span class="attr">redis:4.0.6</span></span><br><span class="line"><span class="attr">        hostname:</span> <span class="string">redis</span></span><br><span class="line"><span class="attr">        networks:</span></span><br><span class="line"><span class="attr">            wordpress:</span></span><br><span class="line"><span class="attr">                aliases:</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="string">redis</span></span><br><span class="line"><span class="attr">        volumes:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">./redis:/data:rw</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">/usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro</span></span><br><span class="line"><span class="attr">        logging:</span></span><br><span class="line"><span class="attr">            driver:</span> <span class="string">json-file</span></span><br><span class="line"><span class="attr">            options:</span></span><br><span class="line"><span class="attr">                max-file:</span> <span class="string">'3'</span></span><br><span class="line"><span class="attr">                max-size:</span> <span class="number">100</span><span class="string">m</span></span><br><span class="line"><span class="comment"># 定义这个compose文件中使用的网络</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">	<span class="comment"># 网络名称，和上文中的wordpress一直，这里注意不是上文中出现的wordpress这个服务，而是是网络！！！</span></span><br><span class="line"><span class="attr">    wordpress:</span></span><br><span class="line">    	<span class="comment"># 是否是外部网络，这里可以理解为如果是外部网络那么网络的名字就叫wordpress，这样方便其他的服务接入到这个网络，如果不是，在你使用docker-compose up -d 命令的时候他会以你当前的文件夹的名字加上这里定义的网络名作为你这个compose的网络。比如我的这个compose文件在test下面，如果external为true，那么你需要手动创建这个网络然后去指定命令启动这个compose；如果为flase则网络的名字将会以test_wordpress出现在你的docker network ls中。具体可以自己去试一下就知道大概是什么意思了。</span></span><br><span class="line"><span class="attr">        external:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<h4 id="集群docker-compose模版"><a href="#集群docker-compose模版" class="headerlink" title="集群docker-compose模版"></a>集群docker-compose模版</h4><p>以下文件中将只会备注单机版中没有说明的部分。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3.4'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">    nginx:</span></span><br><span class="line"><span class="attr">        image:</span> <span class="attr">nginx:1.13.6-alpine</span></span><br><span class="line"><span class="attr">        hostname:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">        ports:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="number">3000</span><span class="string">:80/tcp</span></span><br><span class="line"><span class="attr">        networks:</span></span><br><span class="line"><span class="attr">            xbclub:</span></span><br><span class="line"><span class="attr">                aliases:</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">        volumes:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">/nfs/xbclub/nginx/nginx.conf:/etc/nginx/nginx.conf:ro</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">/nfs/xbclub/www:/var/www/html:rw</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">/usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro</span></span><br><span class="line">        <span class="comment"># 定义你这个服务的运行方式</span></span><br><span class="line"><span class="attr">        deploy:</span></span><br><span class="line">        	<span class="comment"># 模式定义，主要两种，全局模式和副本模式(自己翻译的)，全局模式将会在所有的Swarm节点上运行一个实例，副本模式则指定运行你在replicas指定的个数。</span></span><br><span class="line"><span class="attr">            mode:</span> <span class="string">replicated</span></span><br><span class="line"><span class="attr">            replicas:</span> <span class="number">3</span></span><br><span class="line">            <span class="comment"># 服务的运行规则，下面这部分的意识是“这个Nginx服务将只会匹配集群中的工作节点，但是主机名不是‘Docker-Swarm-MySQL’，‘Docker-Swarm-Redis’，‘Docker-Swarm-NFS’的节点上运行这个Nginx服务”。下面的部分基本大同小异，这里就不啰嗦了。</span></span><br><span class="line"><span class="attr">            placement:</span></span><br><span class="line"><span class="attr">                constraints:</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="string">node.role</span> <span class="string">==</span> <span class="string">worker</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="string">node.hostname</span> <span class="string">!=</span> <span class="string">Docker-Swarm-MySQL</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="string">node.hostname</span> <span class="string">!=</span> <span class="string">Docker-Swarm-Redis</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="string">node.hostname</span> <span class="string">!=</span> <span class="string">Docker-Swarm-NFS</span></span><br><span class="line"><span class="attr">    wordpress:</span></span><br><span class="line"><span class="attr">        image:</span> <span class="attr">wordpress:4.9.1-php7.1-fpm-alpine</span></span><br><span class="line"><span class="attr">        hostname:</span> <span class="string">php</span></span><br><span class="line"><span class="attr">        networks:</span></span><br><span class="line"><span class="attr">            xbclub:</span></span><br><span class="line"><span class="attr">                aliases:</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="string">wordpress</span></span><br><span class="line"><span class="attr">        environment:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">WORDPRESS_DB_HOST=mysql</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">WORDPRESS_DB_USER=root</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">WORDPRESS_DB_PASSWORD=root</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">WORDPRESS_DB_NAME=xbclub</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">WORDPRESS_TABLE_PREFIX=wp_</span></span><br><span class="line"><span class="attr">        volumes:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">/nfs/xbclub/www:/var/www/html:rw</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">/nfs/xbclub/php/uploads.ini:/usr/local/etc/php/conf.d/uploads.ini:ro</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">/usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro</span></span><br><span class="line"><span class="attr">        deploy:</span></span><br><span class="line"><span class="attr">            mode:</span> <span class="string">replicated</span></span><br><span class="line"><span class="attr">            replicas:</span> <span class="number">3</span></span><br><span class="line"><span class="attr">            placement:</span></span><br><span class="line"><span class="attr">                constraints:</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="string">node.role</span> <span class="string">==</span> <span class="string">worker</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="string">node.hostname</span> <span class="string">!=</span> <span class="string">Docker-Swarm-MySQL</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="string">node.hostname</span> <span class="string">!=</span> <span class="string">Docker-Swarm-Redis</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="string">node.hostname</span> <span class="string">!=</span> <span class="string">Docker-Swarm-NFS</span></span><br><span class="line"><span class="attr">    mysql:</span></span><br><span class="line"><span class="attr">        image:</span> <span class="attr">mysql:5.7.20</span></span><br><span class="line"><span class="attr">        hostname:</span> <span class="string">mysql</span></span><br><span class="line"><span class="attr">        networks:</span></span><br><span class="line"><span class="attr">            xbclub:</span></span><br><span class="line"><span class="attr">                aliases:</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="string">mysql</span></span><br><span class="line"><span class="attr">        environment:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">MYSQL_ROOT_PASSWORD=root</span></span><br><span class="line"><span class="attr">        volumes:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">/mysql/xbclub:/var/lib/mysql</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">/usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro</span></span><br><span class="line"><span class="attr">        deploy:</span></span><br><span class="line"><span class="attr">            mode:</span> <span class="string">replicated</span></span><br><span class="line"><span class="attr">            replicas:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">            placement:</span></span><br><span class="line"><span class="attr">                constraints:</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="string">node.hostname</span> <span class="string">==</span> <span class="string">Docker-Swarm-MySQL</span></span><br><span class="line"><span class="attr">        logging:</span></span><br><span class="line"><span class="attr">            driver:</span> <span class="string">json-file</span></span><br><span class="line"><span class="attr">            options:</span></span><br><span class="line"><span class="attr">                max-file:</span> <span class="string">'3'</span></span><br><span class="line"><span class="attr">                max-size:</span> <span class="number">100</span><span class="string">m</span></span><br><span class="line"><span class="attr">    redis:</span></span><br><span class="line"><span class="attr">        image:</span> <span class="attr">redis:4.0.6</span></span><br><span class="line"><span class="attr">        hostname:</span> <span class="string">redis</span></span><br><span class="line"><span class="attr">        networks:</span></span><br><span class="line"><span class="attr">            xbclub:</span></span><br><span class="line"><span class="attr">                aliases:</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="string">redis</span></span><br><span class="line"><span class="attr">        volumes:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">/redis/xbclub:/data:rw</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">/usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro</span></span><br><span class="line"><span class="attr">        deploy:</span></span><br><span class="line"><span class="attr">            mode:</span> <span class="string">replicated</span></span><br><span class="line"><span class="attr">            replicas:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">            placement:</span></span><br><span class="line"><span class="attr">                constraints:</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="string">node.hostname</span> <span class="string">==</span> <span class="string">Docker-Swarm-Redis</span></span><br><span class="line"><span class="comment"># 这里需要说明，集群环境下你需要执行“docker network create --driver overlay NetworkName”命令创建，网络的SCOPE部分显示的是Swarm才是对的。</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line"><span class="attr">    xbclub:</span></span><br><span class="line"><span class="attr">        external:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>这里我只是把我常用的贴出来加以说明，如果各位有想要补充的可以告诉我，我在加上去，详细介绍可以看官网</p>
<p><a href="https://docs.docker.com/compose/compose-file/" target="_blank" rel="noopener">https://docs.docker.com/compose/compose-file/</a></p>
<h2 id="根据项目如何使用Docker部署应用"><a href="#根据项目如何使用Docker部署应用" class="headerlink" title="根据项目如何使用Docker部署应用"></a>根据项目如何使用Docker部署应用</h2><h3 id="Swarm集群下发布基于LRNMP的WordPress应用发布"><a href="#Swarm集群下发布基于LRNMP的WordPress应用发布" class="headerlink" title="Swarm集群下发布基于LRNMP的WordPress应用发布"></a>Swarm集群下发布基于LRNMP的WordPress应用发布</h3><p>​    本实例，默认你已经装好系统，装好Docker并创建好Swarm集群。</p>
<p>​    集群约定，对于无状态应用如Nginx，WordPress我们使用NFS去实现Web站点的数据保存以及共享服务以保证所有容器（Nginx、WordPress）数据一致性问题，MySQL数据库我将指定单台主机去实现MySQL数据库功能，数据库目录将存放在所在宿主机上，那么存在一个问题，MySQL高可用如何去实现，这里可以基于MySQL的架构去实现数据库这块的高可用性本篇不讨论如何实现。</p>
<p>应用目录结构：</p>
<p>站点在NFS主目录位置：/nfs/lnmp</p>
<p>站点目录：/nfs/lnmp/www</p>
<p>Nginx配置文件目录：/nfs/lnmp/nginx</p>
<p>WordPress配合文件目录：/nfs/lnmp/php</p>
<p>Redis数据目录（Docker-Swarm-Redis主机下）：/redis/lnmp</p>
<p>MySQL数据目录（Docker-Swarm-MySQL主机下）：/mysql/lnmp</p>
<p>镜像相关文档：</p>
<p>Redi：<a href="https://hub.docker.com/_/redis/" target="_blank" rel="noopener">https://hub.docker.com/_/redis/</a></p>
<p>Nginx：<a href="https://hub.docker.com/_/nginx/" target="_blank" rel="noopener">https://hub.docker.com/_/nginx/</a></p>
<p>WordPress：<a href="https://hub.docker.com/_/wordpress/" target="_blank" rel="noopener">https://hub.docker.com/_/wordpress/</a></p>
<p>MySQL：<a href="https://hub.docker.com/_/mysql/" target="_blank" rel="noopener">https://hub.docker.com/_/mysql/</a></p>
<p>集群节点清单：</p>
<table>
<thead>
<tr>
<th>主机名</th>
<th style="text-align:center">节点作用</th>
<th style="text-align:right">运行的容器</th>
</tr>
</thead>
<tbody>
<tr>
<td>Docker-Swarm-MySQL</td>
<td style="text-align:center">MySQL节点，只跑MySQL不跑其他的应用</td>
<td style="text-align:right">MySQL</td>
</tr>
<tr>
<td>Docker-Swarm-Redis</td>
<td style="text-align:center">Redis节点，只跑Redis不跑其他的应用</td>
<td style="text-align:right">Redis</td>
</tr>
<tr>
<td>Docker-Swarm-NFS</td>
<td style="text-align:center">NFS节点，只用于数据共享，不运行任何应用</td>
<td style="text-align:right">N/A</td>
</tr>
<tr>
<td>Docker-Swarm-Master01</td>
<td style="text-align:center">Swarm集群管理节点</td>
<td style="text-align:right">N/A</td>
</tr>
<tr>
<td>Docker-Swarm-Node01</td>
<td style="text-align:center">Swarm集群工作节点</td>
<td style="text-align:right">Nginx、WordPress</td>
</tr>
<tr>
<td>Docker-Swarm-Node02</td>
<td style="text-align:center">Swarm集群工作节点</td>
<td style="text-align:right">Nginx、WordPress</td>
</tr>
</tbody>
</table>
<p>准备编排文件，内容如下（docker-compose.yaml）：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3.4'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="attr">    nginx:</span></span><br><span class="line"><span class="attr">        image:</span> <span class="attr">nginx:1.13.6-alpine</span></span><br><span class="line"><span class="attr">        hostname:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">        ports:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="number">3000</span><span class="string">:80/tcp</span></span><br><span class="line"><span class="attr">        networks:</span></span><br><span class="line"><span class="attr">            xbclub:</span></span><br><span class="line"><span class="attr">                aliases:</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">        volumes:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">/nfs/lnmp/nginx/nginx.conf:/etc/nginx/nginx.conf:ro</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">/nfs/lnmp/www:/var/www/html:rw</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">/usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro</span></span><br><span class="line"><span class="attr">        deploy:</span></span><br><span class="line"><span class="attr">            mode:</span> <span class="string">replicated</span></span><br><span class="line"><span class="attr">            replicas:</span> <span class="number">3</span></span><br><span class="line"><span class="attr">            placement:</span></span><br><span class="line"><span class="attr">                constraints:</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="string">node.role</span> <span class="string">==</span> <span class="string">worker</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="string">node.hostname</span> <span class="string">!=</span> <span class="string">Docker-Swarm-MySQL</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="string">node.hostname</span> <span class="string">!=</span> <span class="string">Docker-Swarm-Redis</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="string">node.hostname</span> <span class="string">!=</span> <span class="string">Docker-Swarm-NFS</span></span><br><span class="line"><span class="attr">    wordpress:</span></span><br><span class="line"><span class="attr">        image:</span> <span class="attr">wordpress:4.9.1-php7.1-fpm-alpine</span></span><br><span class="line"><span class="attr">        hostname:</span> <span class="string">php</span></span><br><span class="line"><span class="attr">        networks:</span></span><br><span class="line"><span class="attr">            xbclub:</span></span><br><span class="line"><span class="attr">                aliases:</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="string">wordpress</span></span><br><span class="line"><span class="attr">        environment:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">WORDPRESS_DB_HOST=mysql</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">WORDPRESS_DB_USER=root</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">WORDPRESS_DB_PASSWORD=root</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">WORDPRESS_DB_NAME=xbclub</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">WORDPRESS_TABLE_PREFIX=wp_</span></span><br><span class="line"><span class="attr">        volumes:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">/nfs/lnmp/www:/var/www/html:rw</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">/nfs/lnmp/php/uploads.ini:/usr/local/etc/php/conf.d/uploads.ini:ro</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">/usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro</span></span><br><span class="line"><span class="attr">        deploy:</span></span><br><span class="line"><span class="attr">            mode:</span> <span class="string">replicated</span></span><br><span class="line"><span class="attr">            replicas:</span> <span class="number">3</span></span><br><span class="line"><span class="attr">            placement:</span></span><br><span class="line"><span class="attr">                constraints:</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="string">node.role</span> <span class="string">==</span> <span class="string">worker</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="string">node.hostname</span> <span class="string">!=</span> <span class="string">Docker-Swarm-MySQL</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="string">node.hostname</span> <span class="string">!=</span> <span class="string">Docker-Swarm-Redis</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="string">node.hostname</span> <span class="string">!=</span> <span class="string">Docker-Swarm-NFS</span></span><br><span class="line"><span class="attr">    mysql:</span></span><br><span class="line"><span class="attr">        image:</span> <span class="attr">mysql:5.7.20</span></span><br><span class="line"><span class="attr">        hostname:</span> <span class="string">mysql</span></span><br><span class="line"><span class="attr">        networks:</span></span><br><span class="line"><span class="attr">            xbclub:</span></span><br><span class="line"><span class="attr">                aliases:</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="string">mysql</span></span><br><span class="line"><span class="attr">        environment:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">MYSQL_ROOT_PASSWORD=root</span></span><br><span class="line"><span class="attr">        volumes:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">/mysql/lnmp:/var/lib/mysql</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">/usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro</span></span><br><span class="line"><span class="attr">        deploy:</span></span><br><span class="line"><span class="attr">            mode:</span> <span class="string">replicated</span></span><br><span class="line"><span class="attr">            replicas:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">            placement:</span></span><br><span class="line"><span class="attr">                constraints:</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="string">node.hostname</span> <span class="string">==</span> <span class="string">Docker-Swarm-MySQL</span></span><br><span class="line"><span class="attr">        logging:</span></span><br><span class="line"><span class="attr">            driver:</span> <span class="string">json-file</span></span><br><span class="line"><span class="attr">            options:</span></span><br><span class="line"><span class="attr">                max-file:</span> <span class="string">'3'</span></span><br><span class="line"><span class="attr">                max-size:</span> <span class="number">100</span><span class="string">m</span></span><br><span class="line"><span class="attr">    redis:</span></span><br><span class="line"><span class="attr">        image:</span> <span class="attr">redis:4.0.6</span></span><br><span class="line"><span class="attr">        hostname:</span> <span class="string">redis</span></span><br><span class="line"><span class="attr">        networks:</span></span><br><span class="line"><span class="attr">            xbclub:</span></span><br><span class="line"><span class="attr">                aliases:</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="string">redis</span></span><br><span class="line"><span class="attr">        volumes:</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">/redis/lnmp:/data:rw</span></span><br><span class="line"><span class="bullet">            -</span> <span class="string">/usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro</span></span><br><span class="line"><span class="attr">        deploy:</span></span><br><span class="line"><span class="attr">            mode:</span> <span class="string">replicated</span></span><br><span class="line"><span class="attr">            replicas:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">            placement:</span></span><br><span class="line"><span class="attr">                constraints:</span></span><br><span class="line"><span class="bullet">                    -</span> <span class="string">node.hostname</span> <span class="string">==</span> <span class="string">Docker-Swarm-Redis</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line"><span class="attr">    xbclub:</span></span><br><span class="line"><span class="attr">        external:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>Nginx配置文件（nginx.conf）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">user  nginx nginx;</span><br><span class="line">worker_processes auto;</span><br><span class="line">error_log  /var/log/nginx/error.log warn;</span><br><span class="line">pid        /var/run/nginx.pid;</span><br><span class="line">worker_rlimit_nofile 51200;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    use epoll;</span><br><span class="line">    worker_connections 51200;</span><br><span class="line">    multi_accept on;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    log_format  main  &apos;&#123;&quot;remote_addr&quot;:&quot;$remote_addr&quot;,&apos;</span><br><span class="line">                      &apos;&quot;http_x_forwarded_for&quot;:&quot;$http_x_forwarded_for&quot;,&apos;</span><br><span class="line">                      &apos;&quot;remote_user&quot;:&quot;$remote_user&quot;,&apos;</span><br><span class="line">                      &apos;&quot;time_local&quot;:&quot;$time_local&quot;,&apos;</span><br><span class="line">                      &apos;&quot;request&quot;:&quot;$request&quot;,&apos;</span><br><span class="line">                      &apos;&quot;status&quot;:&quot;$status&quot;,&apos;</span><br><span class="line">                      &apos;&quot;request_time&quot;:&quot;$request_time&quot;,&apos;</span><br><span class="line">                      &apos;&quot;body_bytes_sent&quot;:&quot;$body_bytes_sent&quot;,&apos;</span><br><span class="line">                      &apos;&quot;http_referer&quot;:&quot;$http_referer&quot;,&apos;</span><br><span class="line">                      &apos;&quot;http_user_agent&quot;:&quot;$http_user_agent&quot;&#125;&apos;;</span><br><span class="line"></span><br><span class="line">    server_names_hash_bucket_size 128;</span><br><span class="line">    client_header_buffer_size 32k;</span><br><span class="line">    large_client_header_buffers 4 32k;</span><br><span class="line">    client_max_body_size 50m;</span><br><span class="line"></span><br><span class="line">    sendfile   on;</span><br><span class="line">    tcp_nopush on;</span><br><span class="line"></span><br><span class="line">    keepalive_timeout 60;</span><br><span class="line"></span><br><span class="line">    tcp_nodelay on;</span><br><span class="line"></span><br><span class="line">    fastcgi_connect_timeout 300;</span><br><span class="line">    fastcgi_send_timeout 300;</span><br><span class="line">    fastcgi_read_timeout 300;</span><br><span class="line">    fastcgi_buffer_size 64k;</span><br><span class="line">    fastcgi_buffers 4 64k;</span><br><span class="line">    fastcgi_busy_buffers_size 128k;</span><br><span class="line">    fastcgi_temp_file_write_size 256k;</span><br><span class="line"></span><br><span class="line">    gzip on;</span><br><span class="line">    gzip_min_length  1k;</span><br><span class="line">    gzip_buffers     4 16k;</span><br><span class="line">    gzip_http_version 1.1;</span><br><span class="line">    gzip_comp_level 2;</span><br><span class="line">    gzip_types     text/plain application/javascript application/x-javascript text/javascript text/css application/xml application/xml+rss;</span><br><span class="line">    gzip_vary on;</span><br><span class="line">    gzip_proxied   expired no-cache no-store private auth;</span><br><span class="line">    gzip_disable   &quot;MSIE [1-6]\.&quot;;</span><br><span class="line"></span><br><span class="line">    server_tokens off;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name _;</span><br><span class="line">        index index.html index.htm index.php;</span><br><span class="line">        location / &#123;</span><br><span class="line">            deny all;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server&#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name www.example.com ;</span><br><span class="line">        server_name _;</span><br><span class="line">        index index.html index.htm index.php default.html default.htm default.php;</span><br><span class="line">        root  /var/www/html;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            try_files $uri $uri/ /index.php?$args;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # Add trailing slash to */wp-admin requests.</span><br><span class="line">        rewrite /wp-admin$ $scheme://$host$uri/ permanent;</span><br><span class="line"></span><br><span class="line">        # Deny access to PHP files in specific directory</span><br><span class="line">        #location ~ /(wp-content|uploads|wp-includes|images)/.*\.php$ &#123; deny all; &#125;</span><br><span class="line"></span><br><span class="line">        location ~ [^/]\.php(/|$) &#123;</span><br><span class="line">          try_files $uri =404;</span><br><span class="line">          fastcgi_pass  wordpress:9000;</span><br><span class="line">          fastcgi_index index.php;</span><br><span class="line">          include fastcgi.conf;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$ &#123;</span><br><span class="line">            expires      30d;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location ~ .*\.(js|css)?$ &#123;</span><br><span class="line">            expires      12h;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location ~ /.well-known &#123;</span><br><span class="line">            allow all;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location ~ /\. &#123;</span><br><span class="line">            deny all;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>WordPress配置文件（uploads.ini）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">file_uploads = On</span><br><span class="line">memory_limit = 64M</span><br><span class="line">upload_max_filesize = 64M</span><br><span class="line">post_max_size = 64M</span><br><span class="line">max_execution_time = 600</span><br></pre></td></tr></table></figure>
<p>本实例项目地址：<a href="https://github.com/buxiaomo/docker-compose/tree/master/wordpress" target="_blank" rel="noopener">https://github.com/buxiaomo/docker-compose/tree/master/wordpress</a></p>
<p>总结：</p>
<p>本实例我们直接使用的是官方的镜像，没有做定制操作，原因如下：</p>
<p>1、不要重复造轮子，官方有镜像尽量使用官方的镜像不要自己构建</p>
<p>2、官方镜像有人维护，不需要自己维护，较少成本</p>
<p>3、官方镜像基本可以满足大部分应用需求，所以基本不需要进行定制化，如果需要定制化可以直接使用FROM BASEIMAGE去做定制化，而不是从头再来。</p>
<h3 id="NodeJS应用发布"><a href="#NodeJS应用发布" class="headerlink" title="NodeJS应用发布"></a>NodeJS应用发布</h3><p>​    针对自己写Dockerfile构将APP镜像，首先需要有一点，你的APP必须可以前台运行！！！</p>
<p>​    由于官方有镜像，我们就直接引用即可，不需要自己去构建NodeJS的镜像，这里我一一个NodeJS的WebUI去实现镜像封装以及运行。对于NodeJS应用，大概分为两部分，下载依赖包，运行分为，这里可以更具实际情况决定Dockerfile如何编写，理论上依赖包只需要下载一次就行了，不需要每次运行分为都去下载镜像包，那么针对这种情况可以在构建的时候把依赖包一起打包到镜像中，当然，将依赖包打包到镜像中构建出来的镜像会有点大，但是好处就是启动服务的时候不需要下载依赖包，启动时间会很快，适合离线环境；一种是在启动的时候去下载依赖包，这样的话镜像会小一点，但是启动时会去下载依赖包，启动时间会比较长，具体方式可以自己选。下面简要说一下步骤：</p>
<p>编写Dockerfile内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">FROM node:9.3.0</span><br><span class="line"></span><br><span class="line">ADD app /app/</span><br><span class="line"></span><br><span class="line">WORKDIR /app</span><br><span class="line"></span><br><span class="line">RUN npm i</span><br><span class="line"></span><br><span class="line">EXPOST 7001</span><br><span class="line"></span><br><span class="line">CMD [&quot;npm&quot;,&quot;run&quot;,&quot;dev&quot;]</span><br></pre></td></tr></table></figure>
<p>进入Dockerfile所在目录执行<code>docker build -t=nodejs .</code>构建镜像</p>
<p>待补充</p>
<h3 id="Flask应用发布"><a href="#Flask应用发布" class="headerlink" title="Flask应用发布"></a>Flask应用发布</h3><p>项目代码：<a href="https://github.com/buxiaomo/dockerfile/tree/master/ssserverweb" target="_blank" rel="noopener">https://github.com/buxiaomo/dockerfile/tree/master/ssserverweb</a></p>
<p>​    应用简介：应用通过Docker Engine API对基于Docker Swarm提供的SS服务管理用户添加删除和添加节点的小demo项目，本应用通过Swarm实现。Docker化应用类似于NodeJS。通过阿里云的域名API配置主机IP与域名的关系，本篇只针对应用如何使用Docker部署，代码实现不在本篇讨论范围这里不详细说明。</p>
<p>申明：代码可能存在逻辑问题，不要纠结这个，本篇只讨论如何容器化应用。</p>
<p>可以直接看GitHub的代码查看详情。准备Dockerfile，内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">FROM python:2.7.14</span><br><span class="line"></span><br><span class="line">ADD . /app</span><br><span class="line"></span><br><span class="line">WORKDIR /app</span><br><span class="line"></span><br><span class="line">RUN pip install -r requirements.txt</span><br><span class="line"></span><br><span class="line">ENV ALIYUN_ID NULL</span><br><span class="line">ENV ALIYUN_Secret NULL</span><br><span class="line">ENV ALIYUN_RegionId cn-hangzhou</span><br><span class="line"></span><br><span class="line">ENV Domain NULL</span><br><span class="line">ENV ManagerIP NULL</span><br><span class="line"></span><br><span class="line">EXPOSE 8000</span><br><span class="line"></span><br><span class="line">CMD [&quot;python&quot;,&quot;ssserver.py&quot;]</span><br></pre></td></tr></table></figure>
<p>进入Dockerfile所在目录执行<code>docker build -t=ssserverweb .</code>构建镜像</p>
<p>启动容器：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name ssserverweb </span><br><span class="line">-p 8080:8000 \</span><br><span class="line">-v /var/run/docker.sock:/var/run/docker.sock:ro \</span><br><span class="line">-e ALIYUN_ID=*** \</span><br><span class="line">-e ManagerIP=*** \</span><br><span class="line">-e ALIYUN_Secret=**** \</span><br><span class="line">-e DomainName=www.example.com \</span><br><span class="line">ssserverweb:latest</span><br></pre></td></tr></table></figure>
<p>查看服务，访问链接：<a href="http://IP:8080" target="_blank" rel="noopener">http://IP:8080</a> 即可访问到访问页面</p>
<h3 id="基于Tomcat封装Jenkins镜像"><a href="#基于Tomcat封装Jenkins镜像" class="headerlink" title="基于Tomcat封装Jenkins镜像"></a>基于Tomcat封装Jenkins镜像</h3><p>待补充</p>
<h2 id="每次代码写好了都要自己构建觉得麻烦怎么办？"><a href="#每次代码写好了都要自己构建觉得麻烦怎么办？" class="headerlink" title="每次代码写好了都要自己构建觉得麻烦怎么办？"></a>每次代码写好了都要自己构建觉得麻烦怎么办？</h2><p>1、可以结合GitHub与Dockerhub做到持续构建。</p>
<p>2、使用GitHub代码托管与daocloud的公有云服务，构建速度不错，比Dockerhub快，不用等太久。</p>
<p>3、Jenkins + github/Gitlab（自己动手丰衣足食）</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://SubHyCan.github.io/2019/02/14/Docker-Quick-Start-Guide/" data-id="cjsvb16yb000asyri8a9157br" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>
 


  
    <article id="post-DB-Related" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/02/14/DB-Related/" class="article-date">
  <time datetime="2019-02-14T08:25:49.200Z" itemprop="datePublished">2019-02-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/02/14/DB-Related/">DB Related</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h2 id="DB2"><a href="#DB2" class="headerlink" title="DB2"></a>DB2</h2><h4 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">db2 get snapshot for dynamic sql on 库 &gt;&gt;snap.log                                #动态语句监控 </span><br><span class="line">grep -n &quot;Deadlocks detected&quot; snap.log | grep -v &quot;= 0&quot; | more                     #识别是否存在死锁 </span><br><span class="line">grep -n &quot; Number of executions&quot; snap.log | grep -v &quot;= 0&quot; | sort -k 5,5rn | more  #搜索语句的执行次数</span><br><span class="line">grep -n &quot; Rows read&quot; snap.log | grep -v &quot;= 0&quot; | sort -k 5,5rn                    #读取行数最多的语句</span><br><span class="line">grep -n &quot; Total execution time&quot; snap.log | grep -v &quot;= 0.0&quot; |sort -k 5,5rn | more #获取语句执行时间</span><br><span class="line">grep -n &quot; Statement text&quot; snap.log | more                                        #相似语句排序</span><br><span class="line">cd /opt/ibm/db2/V10.5</span><br><span class="line">db2iset -d db2inst1                                                              #如果无法删除实例，执行此命令删除实例</span><br><span class="line">db2 activate db LYLDB                                                            #激活数据库</span><br><span class="line">db2 deactivate db LYLDB                                                          #关闭激活数据库</span><br><span class="line">db2cklog $归档日志的数字编号                                                     #检查归档日志文件是否完整，返回值&apos;0&apos;，则完整</span><br><span class="line">db2diag -g level=Error,db=SI2DB                                                  #db2diag按日志输出等级，库名过滤db2diag.log文件</span><br><span class="line">db2ckbkp -h $备份文件                                                            #检测备份文件的完整性</span><br></pre></td></tr></table></figure>
<h4 id="表统计"><a href="#表统计" class="headerlink" title="表统计"></a>表统计</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db2 &quot;select count(*) from iplat.TEWWF02&quot;         #表行数统计</span><br><span class="line">db2 &quot;describe table iplat.TEWWF02&quot;               #表结构查看</span><br><span class="line">db2 &quot;select substr(indname,1,10),substr(tabname,1,20),substr(colnames,1,20) from syscat.indexes where tabname=&apos;iplat.TEWWF02&apos;&quot;    #查看表有哪些索引    </span><br><span class="line">db2 &quot;select firstkeycard, first2keycard from syscat.indexes where indname=&apos;I_T1&apos;&quot; #具体表索引查看</span><br></pre></td></tr></table></figure>
<h4 id="db2恢复"><a href="#db2恢复" class="headerlink" title="db2恢复"></a>db2恢复</h4><h5 id="一丶在线备份恢复，需要在线备份包和归档日志"><a href="#一丶在线备份恢复，需要在线备份包和归档日志" class="headerlink" title="一丶在线备份恢复，需要在线备份包和归档日志"></a>一丶在线备份恢复，需要在线备份包和归档日志</h5><h6 id="1丶目录一致使用这种方式"><a href="#1丶目录一致使用这种方式" class="headerlink" title="1丶目录一致使用这种方式"></a>1丶目录一致使用这种方式</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db2 restore db lyldb from /data/db2bak/ taken at 20180710233503 LOGTARGET &apos;/data/db2bak/&apos;                #数据库恢复并指定生成目录 </span><br><span class="line">#上传所需的日志到/data/db2bak/NODE0000/LOGSTREAM0000/下面,可采用的前滚有两种：</span><br><span class="line">(1)丶db2 &quot;rollforward db lyldb to 2018-07-11-11.30.00 using local time overflow log path (/data/db2bak/)&quot;          #前滚到指定时间点</span><br><span class="line">     db2 &quot;rollforward database lyldb stop overflow log path (/data/db2bak/)&quot;</span><br><span class="line">(2)丶db2 &quot;rollforward db lyldb to end of logs and complete overflow log path (/data/db2bak/)&quot;               #前滚到活动日志的末尾</span><br></pre></td></tr></table></figure>
<h6 id="2丶重定向恢复-目录不一致使用这种方式"><a href="#2丶重定向恢复-目录不一致使用这种方式" class="headerlink" title="2丶重定向恢复(目录不一致使用这种方式)"></a>2丶重定向恢复(目录不一致使用这种方式)</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db2 restore db lyldb from /data/db2bak taken at 20180710233503 redirect generate script /data/db2bak/restore.sql    #生成重定向脚本修改restore.sql中表空间的路径，确保与服务器目录一致</span><br><span class="line">db2 -tvf restore.sql -l out.log</span><br><span class="line">db2 &quot;rollforward db lyldb to end of logs and complete overflow log path (/data/db2bak/)&quot;</span><br></pre></td></tr></table></figure>
<h5 id="二丶离线备份恢复"><a href="#二丶离线备份恢复" class="headerlink" title="二丶离线备份恢复"></a>二丶离线备份恢复</h5><h4 id="db2执行计划"><a href="#db2执行计划" class="headerlink" title="db2执行计划"></a>db2执行计划</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db2expln -d SI2DB -i -g -stmtfile t1.sql -terminator &apos;;&apos; -output t1.exp    #t1.sql为一条需要执行计划的sql语句,例如：</span><br><span class="line">UPDATE IPLAT.TEDMDM1 SET SEQ_VALUE=SEQ_VALUE + 1,REC_REVISOR=?,REC_REVISE_TIME=? WHERE SEQ_NAME=?</span><br></pre></td></tr></table></figure>
<h2 id="Oracle"><a href="#Oracle" class="headerlink" title="Oracle"></a>Oracle</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lsnrctl start <span class="comment">#开启监听</span></span><br><span class="line">sqlplus / as sysdba    <span class="comment">#以管理员模式登录</span></span><br></pre></td></tr></table></figure>
<h2 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h2><h3 id="suse-linux-11安装mysql"><a href="#suse-linux-11安装mysql" class="headerlink" title="suse linux 11安装mysql"></a>suse linux 11安装mysql</h3><p>从MySQL官网上分别下载mysql社区版服务器端与客户端应用包:<a href="https://dev.mysql.com/downloads/mysql/5.5.html#downloads" target="_blank" rel="noopener">官网</a><br>例如:<br>MySQL-server-5.5.59-1.sles11.x86_64.rpm<br>MySQL-client-5.5.59-1.sles11.x86_64.rpm</p>
<h4 id="检测系统是否已安装mysql"><a href="#检测系统是否已安装mysql" class="headerlink" title="检测系统是否已安装mysql"></a>检测系统是否已安装mysql</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa | grep mysql</span><br><span class="line"><span class="comment">#若已经安装，则执行以下命令来删除,例如</span></span><br><span class="line">rpm --nodeps -e  mysql-5.5.31-0.7.10 mysql-client-5.5.31-0.7.10</span><br></pre></td></tr></table></figure>
<h4 id="安装mysql"><a href="#安装mysql" class="headerlink" title="安装mysql:"></a>安装mysql:</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh MySQL-server-5.5.59-1.sles11.x86_64.rpm MySQL-client-5.5.59-1.sles11.x86_64.rpm</span><br><span class="line">mkdir /data</span><br><span class="line">chmod 755 -R /data</span><br><span class="line">mv /var/lib/mysql /data</span><br><span class="line">vim /etc/init.d/mysql  <span class="comment">#将datadir的值，修改为/data/mysql</span></span><br><span class="line">cp /usr/share/mysql/my-medium.cnf /etc/my.cnf</span><br></pre></td></tr></table></figure>
<h4 id="编辑-my-cnf，对应内容如下"><a href="#编辑-my-cnf，对应内容如下" class="headerlink" title="编辑 my.cnf，对应内容如下"></a>编辑 my.cnf，对应内容如下</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line">password = 123456</span><br><span class="line">port = 3306</span><br><span class="line">socket = /data/mysql/mysql.sock</span><br><span class="line">default-character-set=utf8</span><br><span class="line">[mysqld]</span><br><span class="line">port = 3306</span><br><span class="line">socket = /data/mysql/mysql.sock</span><br><span class="line">skip-external-locking</span><br><span class="line">key_buffer_size = 16M</span><br><span class="line">max_allowed_packet = 1M</span><br><span class="line">table_open_cache = 64</span><br><span class="line">sort_buffer_size = 512K</span><br><span class="line">net_buffer_length = 8K</span><br><span class="line">read_buffer_size = 256K</span><br><span class="line">read_rnd_buffer_size = 512K</span><br><span class="line">myisam_sort_buffer_size = 8M</span><br><span class="line">character_set_server=utf8</span><br><span class="line">collation-server=utf8_general_ci</span><br><span class="line">lower_case_table_names=1</span><br><span class="line">character_set_client=utf8</span><br><span class="line">max_connections=1000</span><br><span class="line">[mysql]</span><br><span class="line">default-character-set = utf8</span><br><span class="line">no-auto-rehash</span><br></pre></td></tr></table></figure>
<h4 id="重启mysql服务"><a href="#重启mysql服务" class="headerlink" title="重启mysql服务"></a>重启mysql服务</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/bin</span><br><span class="line">mysql_install_db</span><br><span class="line">service mysql restart</span><br></pre></td></tr></table></figure>
<h4 id="登录mysql"><a href="#登录mysql" class="headerlink" title="登录mysql"></a>登录mysql</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br><span class="line">Enterpassword: (直接回车，因为第一次为空密码)</span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">mysql&gt; use mysql;</span><br><span class="line">mysql&gt; show tables;</span><br><span class="line">mysql&gt; update user <span class="built_in">set</span> password=password(<span class="string">'123456'</span>)<span class="built_in">where</span> user=<span class="string">'root'</span>;  <span class="comment">#登录成功后，修改密码</span></span><br><span class="line">/usr/bin/mysqld_safe --user=mysql &amp;</span><br><span class="line">service mysql restart                   <span class="comment">#最后重启mysql，密码生效</span></span><br></pre></td></tr></table></figure>
<h4 id="设置远程访问"><a href="#设置远程访问" class="headerlink" title="设置远程访问"></a>设置远程访问</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p                     </span><br><span class="line">mysql&gt; use mysql; </span><br><span class="line">mysql&gt; grant all PRIVILEGES on *.* to root@192.168.229.70 identified by <span class="string">'password'</span>; </span><br><span class="line">mysql&gt; select host,user from user;</span><br><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>
<h3 id="mysql忘记密码"><a href="#mysql忘记密码" class="headerlink" title="mysql忘记密码"></a>mysql忘记密码</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#停止mysql服务</span></span><br><span class="line">/usr/bin/mysqld_safe --user=mysql --skip-grant-tables &amp;</span><br><span class="line"><span class="comment">#输入mysql进入数据库</span></span><br><span class="line">use mysql;  </span><br><span class="line">update user <span class="built_in">set</span> password=password(<span class="string">"密码"</span>) <span class="built_in">where</span> user=<span class="string">'root'</span>;</span><br><span class="line">flush privileges;</span><br><span class="line"><span class="comment">#重启mysql服务</span></span><br></pre></td></tr></table></figure>
<h3 id="数据库备份"><a href="#数据库备份" class="headerlink" title="数据库备份"></a>数据库备份</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -u用户 -p 库名 &gt;库名.sql              <span class="comment">#备份一个库</span></span><br><span class="line">mysqldump -u用户 -p 库名 表名 &gt;表名.sql         <span class="comment">#备份表            </span></span><br><span class="line">mysqldump -u用户 -p --all-databases &gt;all.sql   <span class="comment">#备份所有库</span></span><br></pre></td></tr></table></figure>
<h3 id="恢复库"><a href="#恢复库" class="headerlink" title="恢复库"></a>恢复库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create database 库名 charset=utf8;</span><br><span class="line">mysql -u用户 -p 库名 &lt;库名.sql                 <span class="comment">#恢复一个库</span></span><br><span class="line"><span class="built_in">source</span> 库名.sql                                <span class="comment">#导入</span></span><br></pre></td></tr></table></figure>
<h3 id="删除库"><a href="#删除库" class="headerlink" title="删除库"></a>删除库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop databases 库名  <span class="comment">#删除库</span></span><br></pre></td></tr></table></figure>
<h3 id="客户端连接远程主机"><a href="#客户端连接远程主机" class="headerlink" title="客户端连接远程主机"></a>客户端连接远程主机</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -pLyl@1992 -h 192.168.229.85 -P3306</span><br></pre></td></tr></table></figure>
<h3 id="windows安装mysql"><a href="#windows安装mysql" class="headerlink" title="windows安装mysql"></a>windows安装mysql</h3><p>1丶下载windows对应的32位或者64位版本，例如32位7.7.22社区版本<br>2丶解压到目录，例如G:\mysql-5.7.22-win32<br>3丶在解压目录bin下初始化mysql<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysqld --initialize-insecure                <span class="comment">#初始化</span></span><br><span class="line">mysql -uroot -p                             <span class="comment">#进入数据库，默认密码为空</span></span><br></pre></td></tr></table></figure></p>
<p>4丶添加环境变量，系统变量path添加:G:\mysql-5.7.22-win32\bin<br>5丶将MySQL服务制作成windows服务<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"G:\mysql-5.7.22-win32\bin\mysqld"</span> --install              <span class="comment">#制作MySQL的Windows服务</span></span><br><span class="line"><span class="string">"G:\mysql-5.7.22-win32\bin\mysqld"</span> --remove               <span class="comment">#移除MySQL的Windows服务</span></span><br><span class="line">net start mysql                                           <span class="comment">#启动MySQL服务</span></span><br><span class="line">net stop mysql                                            <span class="comment">#关闭MySQL服务</span></span><br></pre></td></tr></table></figure></p>
<p>6丶给root设置密码,例如密码为123456<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqladmin -uroot -p password 123456</span><br></pre></td></tr></table></figure></p>
<h2 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h2><p>SUBSTR函数,取一个字段中的某几位<br>SUBSTR(S,m,n)，S表示字段名，m表示开始截取的位置，n表示截取的长度</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://SubHyCan.github.io/2019/02/14/DB-Related/" data-id="cjsvb16ty0000syri0cjzx2fw" class="article-share-link">分享</a>
      
      
      
    </footer>
  </div>
  
</article>
 


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/">&laquo; 上一页</a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>
</section>
           
    <aside id="sidebar">
  
    

  
    
  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title recent-posts">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/03/14/自动化脚本/">自动化脚本</a>
          </li>
        
          <li>
            <a href="/2019/03/14/Python-3-Study/">Python 3 Study</a>
          </li>
        
          <li>
            <a href="/2019/03/14/Other/">Other</a>
          </li>
        
          <li>
            <a href="/2019/03/14/Linux下日常用到的一些命令/">Linux下日常用到的一些命令</a>
          </li>
        
          <li>
            <a href="/2019/03/14/centos-7/">Centos 7</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    

  
    
  
    <!--微信公众号二维码-->


  
</aside>

      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-left">
      &copy; 2014 - 2019 SubCan&nbsp;|&nbsp;
      主题 <a href="https://github.com/giscafer/hexo-theme-cafe/" target="_blank">Cafe</a>
    </div>
     <div id="footer-right">
      联系方式&nbsp;|&nbsp;liyunliang@cymco.cn
    </div>
  </div>
</footer>
 <script src="/jquery/jquery.min.js"></script>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
</nav>
    <img class="back-to-top-btn" src="/images/fly-to-top.png">
<script>
// Elevator script included on the page, already.
window.onload = function() {
  var elevator = new Elevator({
    selector:'.back-to-top-btn',
    element: document.querySelector('.back-to-top-btn'),
    duration: 1000 // milliseconds
  });
}
</script>
      

  
    <script>
      var cloudTieConfig = {
        url: document.location.href, 
        sourceId: "",
        productKey: "e2fb4051c49842688ce669e634bc983f",
        target: "cloud-tie-wrapper"
      };
    </script>
    <script src="https://img1.ws.126.net/f2e/tie/yun/sdk/loader.js"></script>
    

  







<!-- author:forvoid begin -->
<!-- author:forvoid begin -->

  <link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
  <script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script> 
  <script>
  var gitment = new Gitment({
    // id: '页面 ID', // 可选。默认为 location.href
    owner: 'SubHyCan',
    repo: 'SubHyCan.github.io',
    oauth: {
    client_id: '642ba02e800e02a0a972',
    client_secret: '62f84805c3e00a38ae2b8f62c7ffbb789ea7c4ca',
    }
  })
  gitment.render(document.getElementById("gitment_comments"))
</script>


<!-- author:forvoid end -->

<!-- author:forvoid end -->


  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      })
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      })
    </script>
    <script type="text/javascript" src="https://cdn.rawgit.com/mathjax/MathJax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


 <script src="/js/is.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<script src="/js/elevator.js"></script>
  </div>
</body>
</html>